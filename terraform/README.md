# üöÄ –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–∞ –≤ –Ø–Ω–¥–µ–∫—Å –û–±–ª–∞–∫–µ —á–µ—Ä–µ–∑ Terraform

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä –≤ –Ø–Ω–¥–µ–∫—Å –û–±–ª–∞–∫–µ —Å –ø–æ–º–æ—â—å—é Terraform –∏ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞.

---

## üì¶ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [üìã –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#-–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [‚òÅÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ø–Ω–¥–µ–∫—Å –û–±–ª–∞–∫–∞](#-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-—è–Ω–¥–µ–∫—Å-–æ–±–ª–∞–∫–∞)
- [üîë –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ —Ä–æ–ª–µ–π](#-—Å–æ–∑–¥–∞–Ω–∏–µ-—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ-–∞–∫–∫–∞—É–Ω—Ç–∞-–∏-—Ä–æ–ª–µ–π)
- [‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Terraform](#Ô∏è-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-terraform)
- [üöÄ –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ](#-—Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ)
- [‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ](#-–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ)

---

## üìã –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω [Terraform](https://developer.hashicorp.com/terraform/downloads)
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω [YC CLI](https://cloud.yandex.ru/docs/cli/quickstart)
- –ê–∫–∫–∞—É–Ω—Ç –≤ [–Ø–Ω–¥–µ–∫—Å –û–±–ª–∞–∫–µ](https://cloud.yandex.ru)

---

## ‚òÅÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ø–Ω–¥–µ–∫—Å –û–±–ª–∞–∫–∞

### 1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –≤—ã–±–æ—Ä –∫–∞—Ç–∞–ª–æ–≥–∞

```bash
yc init
yc resource-manager cloud list
yc resource-manager folder list

yc iam service-account create \
  --name terraform-k8s \
  --description "For Kubernetes cluster via Terraform"


# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Kubernetes
yc resource-manager folder add-access-binding \
  --id <FOLDER_ID> \
  --role k8s.editor \
  --subject serviceAccount:<SERVICE_ACCOUNT_ID>

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ç—å—é
yc resource-manager folder add-access-binding \
  --id <FOLDER_ID> \
  --role vpc.publicAdmin \
  --subject serviceAccount:<SERVICE_ACCOUNT_ID>

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –º–∞—à–∏–Ω–∞–º–∏
yc resource-manager folder add-access-binding \
  --id <FOLDER_ID> \
  --role compute.editor \
  --subject serviceAccount:<SERVICE_ACCOUNT_ID>

# –î–æ—Å—Ç—É–ø –∫ IAM-–∞–∫–∫–∞—É–Ω—Ç–∞–º
yc resource-manager folder add-access-binding \
  --id <FOLDER_ID> \
  --role iam.serviceAccounts.user \
  --subject serviceAccount:<SERVICE_ACCOUNT_ID>

# (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫
yc resource-manager folder add-access-binding \
  --id <FOLDER_ID> \
  --role load-balancer.admin \
  --subject serviceAccount:<SERVICE_ACCOUNT_ID>

```

# –ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å Terraform

–≠—Ç–æ—Ç –º–æ–¥—É–ª—å —Å–ª—É–∂–∏—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–∞ –≤ Yandex Cloud. –û–Ω –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–≤–∞ –º–æ–¥—É–ª—è:

- `network`: —Å–æ–∑–¥–∞—ë—Ç —Å–µ—Ç—å, –ø–æ–¥—Å–µ—Ç—å –∏ –≥—Ä—É–ø–ø—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
- `k8s`: —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç –≥—Ä—É–ø–ø—ã —É–∑–ª–æ–≤.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

- `modules/`
  - `network/`: –º–æ–¥—É–ª—å –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏.
  - `k8s/`: –º–æ–¥—É–ª—å –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–∞.
- `variables.tf`: –≤—Ö–æ–¥–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞.
- `main.tf`: –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª Terraform.
- `outputs.tf`: –≤—ã—Ö–æ–¥–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ Terraform:

   ```bash
   terraform init
   ```

2. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–ª–∞–Ω –∏–∑–º–µ–Ω–µ–Ω–∏–π:

   ```bash
   terraform plan
   ```

3. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

   ```bash
   terraform apply
   ```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

- **–°–µ—Ä–≤–∏—Å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã**: 
  - `service_account_key_file`: –ü—É—Ç—å –∫ –∫–ª—é—á—É —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞.
  - `user_id`: ID —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- **–°–µ—Ç—å**:
  - `network_name`: –ò–º—è —Å–µ—Ç–∏.
  - `zone`: –ó–æ–Ω–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤.
- **–ö–ª–∞—Å—Ç–µ—Ä**:
  - `name_cluster`: –ò–º—è Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–∞.
  - `node_mem`, `node_cpu`, `core_fraction`: –†–µ—Å—É—Ä—Å—ã —É–∑–ª–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞.

## –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- `network_id`: ID —Å–æ–∑–¥–∞–Ω–Ω–æ–π —Å–µ—Ç–∏.
- `subnet_id`: ID —Å–æ–∑–¥–∞–Ω–Ω–æ–π –ø–æ–¥—Å–µ—Ç–∏.
- `k8s_cluster_id`: ID —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–∞.
